<project name="Pdebuild bootstrap" default="cleanGenerate" basedir=".">
	<target name="cleanGenerate" depends="clean, createTarball" />
	<property name="archsDir" value="additionalArchs" />
	<property name="sourceDir" value="build/eclipse-3.5.2-src" />

	<macrodef name="copyPlugin">
		<attribute name="pluginName" />
		<attribute name="newArch" />
		<sequential>
			<copy todir="${archsDir}/@{pluginName}.@{newArch}">
				<resources>
					<fileset dir="${sourceDir}/plugins/@{pluginName}.ppc">
						<include name="**" />
					</fileset>
				</resources>
			</copy>
		</sequential>
	</macrodef>

	<macrodef name="generateArch">
		<attribute name="newArch" />
		<sequential>
			<copyPlugin pluginName="org.eclipse.swt.gtk.linux"
			            newArch="@{newArch}" />
			<copyPlugin pluginName="org.eclipse.core.filesystem.linux"
			            newArch="@{newArch}" />
			<copyPlugin pluginName="org.eclipse.equinox.launcher.gtk.linux"
			            newArch="@{newArch}" />
			<exec dir="${archsDir}" executable="sh" failonerror="true">
				<arg line="rename.sh @{newArch}" />
			</exec>
			<replace dir="${archsDir}" value="@{newArch}">
				<exclude name="rename.sh" />
				<include name="*@{newArch}/**/*.*" />
				<excludesfile name="${archsDir}/rename.sh" />
				<replacetoken>ppc</replacetoken>
			</replace>
		</sequential>
	</macrodef>

	<target name="init">
		<mkdir dir="${archsDir}" />
		<ant antfile="build.xml" target="applyPatches" />
	</target>

	<target name="clean">
		<delete dir="additionalArchs/*" />
	</target>

	<target name="generate" depends="init">
		<generateArch newArch="ppc64" />
		<generateArch newArch="sparc" />
	    <generateArch newArch="sparc64" />
	</target>

	<target name="createTarball" depends="generate">
		<tar destfile="eclipse-build-additionalArchs.tar.bz2"
		     compression="bzip2"
		     basedir="additionalArchs"
		     includes="**/*" />
	</target>
</project>